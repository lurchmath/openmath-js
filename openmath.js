var OM,OMNode,bind=function(e,t){return function(){return e.apply(t,arguments)}},hasProp={}.hasOwnProperty,slice=[].slice,indexOf=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};(OM=OMNode=function(){function e(t){this.tree=t,this.hasDescendantSatisfying=bind(this.hasDescendantSatisfying,this),this.descendantsSatisfying=bind(this.descendantsSatisfying,this),this.childrenSatisfying=bind(this.childrenSatisfying,this),this.replaceFree=bind(this.replaceFree,this),this.isFreeToReplace=bind(this.isFreeToReplace,this),this.occursFree=bind(this.occursFree,this),this.isFree=bind(this.isFree,this),this.freeVariables=bind(this.freeVariables,this),this.setAttribute=bind(this.setAttribute,this),this.removeAttribute=bind(this.removeAttribute,this),this.getAttribute=bind(this.getAttribute,this),this.replaceWith=bind(this.replaceWith,this),this.remove=bind(this.remove,this),this.index=bind(this.index,this),this.address=bind(this.address,this),this.findChild=bind(this.findChild,this),this.findInParent=bind(this.findInParent,this),this.simpleEncode=bind(this.simpleEncode,this),this.copy=bind(this.copy,this),this.sameObjectAs=bind(this.sameObjectAs,this),this.equals=bind(this.equals,this),this.encode=bind(this.encode,this),Object.defineProperty(this,"parent",{get:function(){return this.tree.p?new e(this.tree.p):void 0}}),Object.defineProperty(this,"type",{get:function(){return this.tree.t}}),Object.defineProperty(this,"value",{get:function(){return"bi"!==this.tree.t?this.tree.v:void 0}}),Object.defineProperty(this,"name",{get:function(){return this.tree.n}}),Object.defineProperty(this,"cd",{get:function(){return this.tree.cd}}),Object.defineProperty(this,"uri",{get:function(){return this.tree.uri}}),Object.defineProperty(this,"symbol",{get:function(){return this.tree.s?new e(this.tree.s):void 0}}),Object.defineProperty(this,"body",{get:function(){return this.tree.b?new e(this.tree.b):void 0}}),Object.defineProperty(this,"children",{get:function(){var t,r,n,i,s,a;for(a=[],r=0,n=(s=null!=(i=this.tree.c)?i:[]).length;r<n;r++)t=s[r],a.push(new e(t));return a}}),Object.defineProperty(this,"variables",{get:function(){var t,r,n,i,s;if("bi"===this.tree.t){for(i=[],t=0,r=(n=this.tree.v).length;t<r;t++)s=n[t],i.push(new e(s));return i}return[]}})}var t;return e.checkJSON=function(e){var t,r,n,i,s,a,c,o,u,h,l,f,p,d,b,v,y,g;if(!(e instanceof Object))return"Expected an object, found "+typeof e;if(e.hasOwnProperty("a")){f=e.a;for(s in f)if(hasProp.call(f,s)){y=f[s];try{v=JSON.parse(s)}catch(e){return e,"Key "+s+" invalid JSON"}if("sy"!==v.t)return"Key "+s+" is not a symbol";if(l=this.checkJSON(v))return l;if(l=this.checkJSON(y))return l}}switch(t=function(){var t,r,n,i;for(n=1<=arguments.length?slice.call(arguments,0):[],t=0,r=(i=Object.keys(e)).length;t<r;t++)if(s=i[t],indexOf.call(n,s)<0&&"t"!==s&&"a"!==s)return"Key "+s+" not valid in object of type "+e.t;return null},n=/^[:A-Za-z_\u0374-\u03FF][:A-Za-z_\u0374-\u03FF.0-9-]*$/,e.t){case"i":if(l=t("v"))return l;if(!/^[+-]?[0-9]+$/.test(""+e.v))return"Not an integer: "+e.v;break;case"f":if(l=t("v"))return l;if("number"!=typeof e.v)return"Not a number: "+e.v+" of type "+typeof e.v;if(isNaN(e.v))return"OpenMath floats cannot be NaN";if(!isFinite(e.v))return"OpenMath floats must be finite";break;case"st":if(l=t("v"))return l;if("string"!=typeof e.v)return"Value for st type was "+typeof e.v+", not string";break;case"ba":if(l=t("v"))return l;if(!(e.v instanceof Uint8Array))return"Value for ba type was not an instance of Uint8Array";break;case"sy":if(l=t("n","cd","uri"))return l;if("string"!=typeof e.n)return"Name for sy type was "+typeof e.n+", not string";if("string"!=typeof e.cd)return"CD for sy type was "+typeof e.cd+", not string";if(null!=e.uri&&"string"!=typeof e.uri)return"URI for sy type was "+typeof e.uri+", not string";if(!n.test(e.n))return"Invalid identifier as symbol name: "+e.n;if(!n.test(e.cd))return"Invalid identifier as symbol CD: "+e.cd;break;case"v":if(l=t("n"))return l;if("string"!=typeof e.n)return"Name for v type was "+typeof e.n+", not string";if(!n.test(e.n))return"Invalid identifier as variable name: "+e.n;break;case"a":if(l=t("c"))return l;if(!(e.c instanceof Array))return"Children of application object was not an array";if(0===e.c.length)return"Application object must have at least one child";for(i=0,c=(p=e.c).length;i<c;i++)if(r=p[i],l=this.checkJSON(r))return l;break;case"bi":if(l=t("s","v","b"))return l;if(l=this.checkJSON(e.s))return l;if("sy"!==e.s.t)return"Head of a binding must be a symbol";if(!(e.v instanceof Array))return"In a binding, the v value must be an array";for(a=0,o=(d=e.v).length;a<o;a++){if(g=d[a],l=this.checkJSON(g))return l;if("v"!==g.t)return"In a binding, all values in the v array must have type v"}if(l=this.checkJSON(e.b))return l;break;case"e":if(l=t("s","c"))return l;if(l=this.checkJSON(e.s))return l;if("sy"!==e.s.t)return"Head of an error must be a symbol";if(!(e.c instanceof Array))return"In an error, the c key must be an array";for(h=0,u=(b=e.c).length;h<u;h++)if(r=b[h],l=this.checkJSON(r))return l;break;default:return"Invalid type: "+e.t}return null},e.decode=function(t){var r,n;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return e.message}return(r=this.checkJSON(t))?r:((n=function(e){var t,r,i,s,a,c,o,u,h,l,f,p,d;for(r=0,a=(u=null!=(o=e.c)?o:[]).length;r<a;r++)(t=u[r]).p=e,n(t);for(s=0,c=(l=null!=(h=e.v)?h:[]).length;s<c;s++)(d=l[s]).p=e,n(d);p=null!=(f=e.a)?f:{};for(i in p)hasProp.call(p,i)&&((d=p[i]).p=e,n(d));if(null!=e.s&&(e.s.p=e,n(e.s)),null!=e.b)return e.b.p=e,n(e.b)})(t),t.p=null,new e(t))},e.prototype.encode=function(){return JSON.stringify(this.tree,function(e,t){return"p"===e?void 0:t})},e.prototype.equals=function(e,t){var r;return null==t&&(t=!0),(r=function(e,n){var i,s,a,c,o,u;if(e===n)return!0;if(e instanceof Array||e instanceof Uint8Array){if(e instanceof Array&&!(n instanceof Array))return!1;if(e instanceof Uint8Array&&!(n instanceof Uint8Array))return!1;if(e.length!==n.length)return!1;for(s=a=0,o=e.length;a<o;s=++a)if(i=e[s],!r(i,n[s]))return!1;return!0}if(!(e instanceof Object))return!1;if(!(n instanceof Object))return!1;for(c in e)if(hasProp.call(e,c)&&(u=e[c],"p"!==c&&(t||"a"!==c))){if(!n.hasOwnProperty(c))return!1;if(!r(u,n[c]))return!1}for(c in n)if(hasProp.call(n,c)&&(u=n[c],"p"!==c&&(t||"a"!==c)&&!e.hasOwnProperty(c)))return!1;return!0})(this.tree,e.tree)},e.prototype.sameObjectAs=function(e){return this.tree===(null!=e?e.tree:void 0)},e.prototype.copy=function(){var t;return t=function(e){var r,n,i,s,a,c,o;a=function(){switch(e.t){case"i":case"f":case"st":return{t:e.t,v:e.v};case"v":return{t:"v",n:e.n};case"sy":return a={t:"sy",n:e.n,cd:e.cd},e.hasOwnProperty("uri")&&(a.uri=e.uri),a;case"ba":return{t:"ba",v:new Uint8Array(e.v)};case"e":case"a":return a={t:e.t,c:function(){var n,i,s,a;for(a=[],n=0,i=(s=e.c).length;n<i;n++)r=s[n],a.push(t(r));return a}()},"e"===e.t&&(a.s=t(e.s)),a;case"bi":return{t:"bi",s:t(e.s),v:function(){var r,n,i,s;for(s=[],r=0,n=(i=e.v).length;r<n;r++)o=i[r],s.push(t(o));return s}(),b:t(e.b)}}}(),s=null!=(i=e.a)?i:{};for(n in s)hasProp.call(s,n)&&(c=s[n],(null!=a.a?a.a:a.a={})[n]=t(c));return a},e.decode(t(this.tree))},e.integer=function(t){return e.decode({t:"i",v:t})},e.float=function(t){return e.decode({t:"f",v:t})},e.string=function(t){return e.decode({t:"st",v:t})},e.bytearray=function(t){return e.decode({t:"ba",v:t})},e.symbol=function(t,r,n){return e.decode(null!=n?{t:"sy",n:t,cd:r,uri:n}:{t:"sy",n:t,cd:r})},e.variable=function(t){return e.decode({t:"v",n:t})},e.application=function(){var t,r,n,i,s;for(s={t:"a",c:[]},n=0,i=(r=1<=arguments.length?slice.call(arguments,0):[]).length;n<i;n++)t=r[n],s.c.push(t instanceof e?JSON.parse(t.encode()):t);return e.decode(s)},e.attribution=function(){var t,r,n,i;if(n=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],!(n instanceof Object))return"Invalid first parameter to attribution";if(t.length%2!=0)return"Incomplete key-value pair in attribution";for(n instanceof e&&(n=JSON.parse(n.encode()));t.length>0;)null==n.a&&(n.a={}),r=(r=t.shift())instanceof e?r.encode():JSON.stringify(r),i=t.shift(),n.a[r]=i instanceof e?JSON.parse(i.encode()):i;return e.decode(n)},e.binding=function(){var t,r,n,i,s,a,c,o;if(r=arguments[0],o=3<=arguments.length?slice.call(arguments,1,n=arguments.length-1):(n=1,[]),t=arguments[n++],!(r instanceof Object))return"Invalid first parameter to binding";if(!(t instanceof Object))return"Invalid last parameter to binding";for(a={t:"bi",s:r instanceof e?JSON.parse(r.encode()):r,v:[],b:t instanceof e?JSON.parse(t.encode()):t},i=0,s=o.length;i<s;i++)c=o[i],a.v.push(c instanceof e?JSON.parse(c.encode()):c);return e.decode(a)},e.error=function(){var t,r,n,i,s,a;if(t=arguments[0],s=2<=arguments.length?slice.call(arguments,1):[],!(t instanceof Object))return"Invalid first parameter to binding";for(a={t:"e",s:t instanceof e?JSON.parse(t.encode()):t,c:[]},r=0,n=s.length;r<n;r++)i=s[r],a.c.push(i instanceof e?JSON.parse(i.encode()):i);return e.decode(a)},t=[{name:"symbol",pattern:/[:A-Za-z_][:A-Za-z_0-9-]*\.[:A-Za-z_][:A-Za-z_0-9-]*/},{name:"variable",pattern:/[:A-Za-z_][:A-Za-z_0-9-]*/},{name:"float",pattern:/[+-]?(?:[0-9]+\.[0-9]*|[0-9]*\.[0-9]+)/},{name:"integer",pattern:/[+-]?[0-9]+/},{name:"string",pattern:/"(?:[^"\\]|\\"|\\\\)*"|'(?:[^'\\]|\\'|\\\\)*'/},{name:"comma",pattern:/,/},{name:"openParen",pattern:/\(/},{name:"closeParen",pattern:/\)/},{name:"openBracket",pattern:/\[/},{name:"closeBracket",pattern:/\]/}],e.simpleDecode=function(r){var n,i,s,a,c,o,u,h,l,f,p,d,b,v,y,g,m,O,M,x,A,k,w,S;if("string"!=typeof r)return"Input was not a string";for(w=[];r.length>0;){for(g=r.length,o=0,h=t.length;o<h;o++)null!=(d=(k=t[o]).pattern.exec(r))&&0===d.index&&(w.push({type:k.name,text:d[0]}),r=r.slice(d[0].length));if(r.length===g)return"Could not understand from here: "+r.slice(0,11)}for(A="expression about to start",x=[];w.length>0;){switch(v=w.shift(),A){case"expression about to start":switch(v.type){case"symbol":s=v.text.split("."),x.unshift({node:e.symbol(s[1],s[0])});break;case"variable":x.unshift({node:e.variable(v.text)});break;case"integer":c=parseInt(v.text),/\./.test(c)&&(c=v.text),x.unshift({node:e.integer(c)});break;case"float":x.unshift({node:e.float(parseFloat(v.text))});break;case"string":S=v.text[0],v=v.text.slice(1,-1).replace(RegExp("\\\\"+S,"g"),S),x.unshift({node:e.string(v)});break;default:return"Unexpected "+v.text}A="expression ended";break;case"expression ended":switch(v.type){case"comma":A="expression about to start";break;case"openParen":x[0].head="application","closeParen"===(null!=w&&null!=(m=w[0])?m.type:void 0)?(w.shift(),x.unshift({node:e.application(x.shift().node)}),A="expression ended"):A="expression about to start";break;case"openBracket":x[0].head="binding",A="expression about to start";break;case"closeParen":for(a=u=0,l=x.length;u<l&&"application"!==(i=x[a]).head;a=++u)if("binding"===i.head)return"Mismatch: [ closed by )";if(a===x.length)return"Unexpected )";for(n=[],p=0,O=a;0<=O?p<=O:p>=O;0<=O?++p:--p)n.unshift(x.shift().node);x.unshift({node:e.application.apply(null,n)});break;case"closeBracket":for(a=b=0,f=x.length;b<f&&"binding"!==(i=x[a]).head;a=++b)if("application"===i.head)return"Mismatch: ( closed by ]";if(a===x.length)return"Unexpected ]";for(n=[],y=0,M=a;0<=M?y<=M:y>=M;0<=M?++y:--y)n.unshift(x.shift().node);x.unshift({node:e.binding.apply(null,n)});break;default:return"Unexpected "+v.text}}if("string"==typeof(null!=x?x[0].node:void 0))return x[0].node}return x.length>1?"Unexpected end of input":x[0].node},e.prototype.simpleEncode=function(){var e;return(e=function(t){var r,n,i,s,a,c;switch(null!=t?t.t:void 0){case"i":case"f":return""+t.v;case"v":return t.n;case"st":return"'"+t.v.replace(/'/g,"\\'")+"'";case"sy":return t.cd+"."+t.n;case"ba":return"'byte array'";case"e":return"'error'";case"a":return i=function(){var r,i,s,a;for(a=[],r=0,i=(s=t.c).length;r<i;r++)n=s[r],a.push(e(n));return a}(),(s=i.shift())+"("+i.join(",")+")";case"bi":return c=function(){var r,n,i,s;for(s=[],r=0,n=(i=t.v).length;r<n;r++)a=i[r],s.push(e(a));return s}(),s=e(t.s),r=e(t.b),s+"["+c.join(",")+","+r+"]";default:return"Error: Invalid OpenMath type "+(null!=t?t.t:void 0)}})(this.tree)},e.prototype.findInParent=function(){var e,t,r,n,i,s,a,c,o,u,h,l,f;if(this.parent){for(t=r=0,s=(c=this.parent.children).length;r<s;t=++r)if(e=c[t],this.sameObjectAs(e))return"c"+t;if("v"===this.type)for(t=i=0,a=(o=this.parent.variables).length;i<a;t=++i)if(f=o[t],this.sameObjectAs(f))return"v"+t;if(this.sameObjectAs(this.parent.symbol))return"s";if(this.sameObjectAs(this.parent.body))return"b";h=null!=(u=this.parent.tree.a)?u:{};for(n in h)if(hasProp.call(h,n)&&(l=h[n],this.tree===l))return n}},e.prototype.findChild=function(t){switch(t[0]){case"c":return this.children[parseInt(t.slice(1))];case"v":return this.variables[parseInt(t.slice(1))];case"s":return this.symbol;case"b":return this.body;case"{":return this.getAttribute(e.decode(t))}},e.prototype.address=function(e){return!this.parent||this.sameObjectAs(e)?[]:this.parent.address(e).concat([this.findInParent()])},e.prototype.index=function(e){var t;if(e instanceof Array)return 0===e.length?this:null!=(t=this.findChild(e[0]))?t.index(e.slice(1)):void 0},e.prototype.remove=function(){var e;if(e=this.findInParent()){switch(e[0]){case"c":this.parent.tree.c.splice(parseInt(e.slice(1)),1);break;case"v":this.parent.tree.v.splice(parseInt(e.slice(1)),1);break;case"b":delete this.parent.tree.b;break;case"s":delete this.parent.tree.s;break;case"{":delete this.parent.tree.a[e]}return delete this.tree.p}},e.prototype.replaceWith=function(t){var r,n;if(!this.sameObjectAs(t)&&!("s"===(r=this.findInParent())&&"sy"!==t.type||"v"===(null!=r?r[0]:void 0)&&"v"!==t.type)){switch(t.remove(),n=new e(this.tree),this.tree=t.tree,null!=r?r[0]:void 0){case"c":n.parent.tree.c[parseInt(r.slice(1))]=this.tree;break;case"v":n.parent.tree.v[parseInt(r.slice(1))]=this.tree;break;case"b":n.parent.tree.b=this.tree;break;case"s":n.parent.tree.s=this.tree;break;case"{":n.parent.tree.a[r]=this.tree;break;default:return}return this.tree.p=n.tree.p,delete n.tree.p,n}},e.prototype.getAttribute=function(t){var r,n,i,s,a,c;if(t instanceof e&&"sy"===t.type){i=RegExp('"n":"'+t.name+'"'),r=RegExp('"cd":"'+t.cd+'"'),a=null!=(s=this.tree.a)?s:{};for(n in a)if(hasProp.call(a,n)&&(c=a[n],i.test(n)&&r.test(n)))return new e(c)}},e.prototype.removeAttribute=function(t){var r,n,i,s,a,c;if(t instanceof e&&"sy"===t.type){i=RegExp('"n":"'+t.name+'"'),r=RegExp('"cd":"'+t.cd+'"'),a=null!=(s=this.tree.a)?s:{};for(n in a)if(hasProp.call(a,n)&&(c=a[n],i.test(n)&&r.test(n)))return new e(c).remove(),void delete this.tree.a[n]}},e.prototype.setAttribute=function(t,r){var n;if(t instanceof e&&r instanceof e&&"sy"===t.type)return this.removeAttribute(t),r.remove(),(null!=(n=this.tree).a?n.a:n.a={})[t.encode()]=r.tree,r.tree.p=this.tree},e.prototype.freeVariables=function(){var e,t,r,n,i,s,a,c,o,u,h,l,f,p,d;switch(this.type){case"v":return[this.name];case"a":case"c":for(l=[],r=0,i=(o=this.children).length;r<i;r++)for(n=0,s=(u=o[r].freeVariables()).length;n<s;n++)t=u[n],indexOf.call(l,t)<0&&l.push(t);return l;case"bi":for(e=function(){var e,t,r,n;for(n=[],t=0,e=(r=this.variables).length;t<e;t++)p=r[t],n.push(p.name);return n}.call(this),f=[],c=0,a=(h=this.body.freeVariables()).length;c<a;c++)d=h[c],indexOf.call(e,d)<0&&f.push(d);return f;default:return[]}},e.prototype.isFree=function(e){var t,r,n,i,s,a,c;for(r=this.freeVariables(),c=this;c;){if("bi"===c.type)for(t=function(){var e,t,r,n;for(n=[],e=0,t=(r=c.variables).length;e<t;e++)s=r[e],n.push(s.name);return n}(),n=0,i=r.length;n<i;n++)if(a=r[n],indexOf.call(t,a)>=0)return!1;if(c.sameObjectAs(e))break;c=c.parent}return!0},e.prototype.occursFree=function(e){var t,r,n,i,s;if(this.equals(e)&&this.isFree())return!0;if(null!=(n=this.symbol)?n.equals(e):void 0)return!0;if(null!=(i=this.body)?i.occursFree(e):void 0)return!0;for(t=0,r=(s=this.children).length;t<r;t++)if(s[t].occursFree(e))return!0;return!1},e.prototype.isFreeToReplace=function(t,r){var n,i,s;if(this.sameObjectAs(t))return!0;if(null==t.parent)return!0;for(n=t;n.parent;)n=n.parent;return s=new e(t.tree),!!t.replaceWith(this.copy())&&(i=t.isFree(r),t.replaceWith(s),i)},e.prototype.replaceFree=function(t,r,n){var i,s,a,c,o,u,h,l,f,p,d;if(null==n&&(n=this),this.isFree(n)&&this.equals(t))return d=new e(this.tree),this.replaceWith(r.copy()),void(this.isFree(n)||this.replaceWith(d));for(null!=(u=this.symbol)&&u.replaceFree(t,r,n),null!=(h=this.body)&&h.replaceFree(t,r,n),s=0,c=(l=this.variables).length;s<c;s++)l[s].replaceFree(t,r,n);for(p=[],a=0,o=(f=this.children).length;a<o;a++)i=f[a],p.push(i.replaceFree(t,r,n));return p},e.prototype.childrenSatisfying=function(e){var t,r,n,i,s;for(null==e&&(e=function(){return!0}),r=this.children,null!=this.symbol&&r.push(this.symbol),r=r.concat(this.variables),null!=this.body&&r.push(this.body),s=[],n=0,i=r.length;n<i;n++)e(t=r[n])&&s.push(t);return s},e.prototype.descendantsSatisfying=function(e){var t,r,n,i,s;for(null==e&&(e=function(){return!0}),s=[],e(this)&&s.push(this),r=0,n=(i=this.childrenSatisfying()).length;r<n;r++)t=i[r],s=s.concat(t.descendantsSatisfying(e));return s},e.prototype.hasDescendantSatisfying=function(e){var t,r,n;if(null==e&&(e=function(){return!0}),e(this))return!0;for(t=0,r=(n=this.childrenSatisfying()).length;t<r;t++)if(n[t].hasDescendantSatisfying(e))return!0;return!1},e}()).int=OM.integer,OM.flo=OM.float,OM.str=OM.string,OM.byt=OM.bytearray,OM.sym=OM.symbol,OM.var=OM.variable,OM.app=OM.application,OM.att=OM.attribution,OM.bin=OM.binding,OM.err=OM.error,OM.simple=OM.simpleDecode,OM.encodeAsIdentifier=function(e){var t,r,n,i,s;for(t=function(t){return("000"+e.charCodeAt(t).toString(16)).slice(-4)},s="id_",r=n=0,i=e.length;0<=i?n<i:n>i;r=0<=i?++n:--n)s+=t(r);return s},OM.decodeIdentifier=function(e){var t;if(t="","id_"!==e.slice(0,3))return t;for(e=e.slice(3);e.length>0;)t+=String.fromCharCode(parseInt(e.slice(0,4),16)),e=e.slice(4);return t},OM.prototype.toXML=function(){var e,t,r,n,i,s;switch(n=function(e){return"  "+e.replace(RegExp("\n","g"),"\n  ")},this.type){case"i":return"<OMI>"+this.value+"</OMI>";case"sy":return'<OMS cd="'+this.cd+'" name="'+this.name+'"/>';case"v":return'<OMV name="'+this.name+'"/>';case"f":return'<OMF dec="'+this.value+'"/>';case"st":return"<OMSTR>"+this.value.replace(/\&/g,"&amp;").replace(/</g,"&lt;")+"</OMSTR>";case"a":return"<OMA>\n"+function(){var e,r,i,s;for(s=[],e=0,r=(i=this.children).length;e<r;e++)t=i[e],s.push(n(t.toXML()));return s}.call(this).join("\n")+"\n</OMA>";case"bi":return r=n(this.symbol.toXML()),s=function(){var e,t,r,n;for(n=[],e=0,t=(r=this.variables).length;e<t;e++)i=r[e],n.push(i.toXML());return n}.call(this).join(""),s=n("<OMBVAR>"+s+"</OMBVAR>"),e=n(this.body.toXML()),"<OMBIND>\n"+r+"\n"+s+"\n"+e+"\n</OMBIND>";default:throw"Cannot convert this to XML: "+this.simpleEncode()}},OM.prototype.evaluate=function(){var e,t,r;return e=function(e){return function(){var t,r,n,i,s,a,c,o,u,h;for(i=arguments[0],a=2<=arguments.length?slice.call(arguments,1):[],u=void 0,r=[],c=0,o=a.length;c<o;c++){if(s=a[c],null==(t=e.children[s].evaluate()).value)return t;null!=t.message&&(null==u?u="":u+="\n",u+=t.message),r.push(t.value)}try{h=i.apply(null,r)}catch(e){n=e,null==u?u="":u+="\n",u+=n.message}return{value:h,message:u}}}(this),null==(t=function(){switch(this.type){case"i":case"f":return{value:new Number(this.value)};case"st":case"ba":return{value:this.value};case"v":switch(this.name){case"π":return{value:Math.PI,message:"The actual value of π has been rounded."};case"e":return{value:Math.exp(1),message:"The actual value of e has been rounded."}}break;case"sy":switch(this.simpleEncode()){case"units.degrees":return{value:Math.PI/180,message:"Converting to degrees used an approximation of π."};case"units.percent":return{value:.01};case"units.dollars":return{value:1,message:"Dollar units were dropped"}}break;case"a":switch(this.children[0].simpleEncode()){case"arith1.plus":return e(function(e,t){return e+t},1,2);case"arith1.minus":return e(function(e,t){return e-t},1,2);case"arith1.times":return e(function(e,t){return e*t},1,2);case"arith1.divide":return e(function(e,t){return e/t},1,2);case"arith1.power":return e(Math.pow,1,2);case"arith1.root":return e(function(e,t){return Math.pow(t,1/e)},1,2);case"arith1.abs":return e(Math.abs,1);case"arith1.unary_minus":return e(function(e){return-e},1);case"relation1.eq":return e(function(e,t){return e===t},1,2);case"relation1.approx":return(null!=(r=e(function(e,t){return Math.abs(e-t)<.01},1,2)).message?r.message:r.message="").length&&(r.message+="\n"),r.message+="Values were rounded to two decimal places for approximate comparison.",r;case"relation1.neq":return e(function(e,t){return e!==t},1,2);case"relation1.lt":return e(function(e,t){return e<t},1,2);case"relation1.gt":return e(function(e,t){return e>t},1,2);case"relation1.le":return e(function(e,t){return e<=t},1,2);case"relation1.ge":return e(function(e,t){return e>=t},1,2);case"logic1.not":return e(function(e){return!e},1);case"transc1.sin":return e(Math.sin,1);case"transc1.cos":return e(Math.cos,1);case"transc1.tan":return e(Math.tan,1);case"transc1.cot":return e(function(e){return 1/Math.tan(e)},1);case"transc1.sec":return e(function(e){return 1/Math.cos(e)},1);case"transc1.csc":return e(function(e){return 1/Math.sin(e)},1);case"transc1.arcsin":return e(Math.asin,1);case"transc1.arccos":return e(Math.acos,1);case"transc1.arctan":return e(Math.atan,1);case"transc1.arccot":return e(function(e){return Math.atan(1/e)},1);case"transc1.arcsec":return e(function(e){return Math.acos(1/e)},1);case"transc1.arccsc":return e(function(e){return Math.asin(1/e)},1);case"transc1.ln":return e(Math.log,1);case"transc1.log":return e(function(e,t){return Math.log(t)/Math.log(e)},1,2);case"integer1.factorial":return e(function(e){var r,n,i;if(e<=1)return 1;if(e>=20)return Infinity;for(t=1,r=n=1,i=0|e;1<=i?n<=i:n>=i;r=1<=i?++n:--n)t*=r;return t},1)}}}.call(this))&&(t={value:void 0}),void 0===t.value&&(t.message="Could not evaluate "+this.simpleEncode()),t},"undefined"!=typeof exports&&null!==exports&&(exports.OMNode=exports.OM=OM);
//# sourceMappingURL=openmath.js.map
